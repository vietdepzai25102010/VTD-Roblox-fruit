-- VTD Roblox Auto Fruit Full Script + Anti Cheat + Popup Neon (Kh√¥ng c·∫ßn Key)
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TeleportService = game:GetService("TeleportService")
local RunService = game:GetService("RunService")
local StarterGui = game:GetService("StarterGui")
local TweenService = game:GetService("TweenService")
local HttpService = game:GetService("HttpService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")

-- H√†m hop server
local function HopServer()
    local placeId = game.PlaceId
    local servers = {}
    local cursor = ""
    local success, result

    repeat
        success, result = pcall(function()
            return HttpService:JSONDecode(
                game:HttpGet("https://games.roblox.com/v1/games/"..placeId.."/servers/Public?sortOrder=Asc&limit=100"..(cursor ~= "" and "&cursor="..cursor or ""))
            )
        end)
        if success and result and result.data then
            for _, v in pairs(result.data) do
                if v.playing < v.maxPlayers and v.id ~= game.JobId then
                    table.insert(servers, v.id)
                end
            end
            cursor = result.nextPageCursor or ""
        end
    until cursor == "" or not success

    if #servers > 0 then
        TeleportService:TeleportToPlaceInstance(placeId, servers[math.random(1, #servers)], player)
    else
        TeleportService:Teleport(placeId, player) -- fallback n·∫øu kh√¥ng t√¨m ƒë∆∞·ª£c server kh√°c
    end
end

-- Anti cheat / anti reset / anti vƒÉng
local function protectPlayer()
    character:WaitForChild("Humanoid").Died:Connect(function()
        wait(1)
        player:LoadCharacter()
    end)
    Players.PlayerRemoving:Connect(function(plr)
        if plr == player then
            wait(2)
            HopServer()
        end
    end)
    player.OnTeleport:Connect(function(state)
        if state == Enum.TeleportState.Teleported then
            wait(3)
            initVTD()
        end
    end)
end
protectPlayer()

-- H√†m ch√≠nh initVTD
function initVTD()
    local AutoPickup = true
    local ServerHopTime = 7
    local ScanInterval = 0.2
    local stats = {Common=0, Uncommon=0, Rare=0, Mythic=0, Legend=0}
    local startTime = os.time()

    -- GUI ch√≠nh
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Parent = player:WaitForChild("PlayerGui")
    ScreenGui.ResetOnSpawn = false
    ScreenGui.Name = "VTD Roblox Main"

    local Frame = Instance.new("Frame")
    Frame.Size = UDim2.new(0,300,0,180)
    Frame.Position = UDim2.new(0,20,0,20)
    Frame.BackgroundColor3 = Color3.fromRGB(20,20,20)
    Frame.BorderSizePixel = 0
    Frame.Parent = ScreenGui
    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0,15)
    UICorner.Parent = Frame

    local Border = Instance.new("Frame")
    Border.Size = UDim2.new(1,6,1,6)
    Border.Position = UDim2.new(0,-3,0,-3)
    Border.BackgroundColor3 = Color3.fromRGB(0,255,255)
    Border.BorderSizePixel = 0
    Border.ZIndex = 0
    Border.Parent = Frame
    local BorderCorner = Instance.new("UICorner")
    BorderCorner.CornerRadius = UDim.new(0,18)
    BorderCorner.Parent = Border

    local Title = Instance.new("TextLabel")
    Title.Size = UDim2.new(1,0,0,30)
    Title.Position = UDim2.new(0,0,0,0)
    Title.BackgroundTransparency = 1
    Title.Text = "VTD Roblox"
    Title.TextColor3 = Color3.fromRGB(0,255,255)
    Title.Font = Enum.Font.GothamBold
    Title.TextSize = 18
    Title.Parent = Frame

    local toggle = Instance.new("TextButton")
    toggle.Size = UDim2.new(0,200,0,40)
    toggle.Position = UDim2.new(0.5,-100,0,50)
    toggle.Text = "T·∫Øt Auto Fruit"
    toggle.Font = Enum.Font.GothamBold
    toggle.TextSize = 16
    toggle.TextColor3 = Color3.fromRGB(0,255,255)
    toggle.BackgroundColor3 = Color3.fromRGB(20,20,20)
    toggle.BorderSizePixel = 0
    toggle.Parent = Frame
    local cornerBtn = Instance.new("UICorner")
    cornerBtn.CornerRadius = UDim.new(0,12)
    cornerBtn.Parent = toggle

    local InfoLabel = Instance.new("TextLabel")
    InfoLabel.Size = UDim2.new(1,0,0,50)
    InfoLabel.Position = UDim2.new(0,0,0,110)
    InfoLabel.BackgroundTransparency = 1
    InfoLabel.Text = "Auto Fruit ƒëang ho·∫°t ƒë·ªông..."
    InfoLabel.TextColor3 = Color3.fromRGB(0,255,255)
    InfoLabel.Font = Enum.Font.Gotham
    InfoLabel.TextSize = 16
    InfoLabel.TextWrapped = true
    InfoLabel.Parent = Frame

    -- B·∫£ng th·ªëng k√™ b√™n ph·∫£i
    local StatsFrame = Instance.new("Frame")
    StatsFrame.Size = UDim2.new(0,220,0,200)
    StatsFrame.Position = UDim2.new(1,-230,0,20)
    StatsFrame.AnchorPoint = Vector2.new(0,0)
    StatsFrame.BackgroundColor3 = Color3.fromRGB(15,15,15)
    StatsFrame.BorderSizePixel = 0
    StatsFrame.Parent = ScreenGui
    local StatsCorner = Instance.new("UICorner")
    StatsCorner.CornerRadius = UDim.new(0,12)
    StatsCorner.Parent = StatsFrame

    local StatsTitle = Instance.new("TextLabel")
    StatsTitle.Size = UDim2.new(1,0,0,30)
    StatsTitle.Position = UDim2.new(0,0,0,0)
    StatsTitle.BackgroundTransparency = 1
    StatsTitle.Text = "Th·ªëng k√™ Auto Fruit"
    StatsTitle.TextColor3 = Color3.fromRGB(0,255,255)
    StatsTitle.Font = Enum.Font.GothamBold
    StatsTitle.TextSize = 16
    StatsTitle.Parent = StatsFrame

    local StatsLabel = Instance.new("TextLabel")
    StatsLabel.Size = UDim2.new(1,0,1,-30)
    StatsLabel.Position = UDim2.new(0,0,0,30)
    StatsLabel.BackgroundTransparency = 1
    StatsLabel.TextColor3 = Color3.fromRGB(0,255,255)
    StatsLabel.Font = Enum.Font.Gotham
    StatsLabel.TextSize = 14
    StatsLabel.TextWrapped = true
    StatsLabel.TextYAlignment = Enum.TextYAlignment.Top
    StatsLabel.Text = "ƒêang c·∫≠p nh·∫≠t..."
    StatsLabel.Parent = StatsFrame

    -- Neon nh·∫•p nh√°y
    spawn(function()
        local colors = {Color3.fromRGB(0,255,255), Color3.fromRGB(255,0,255), Color3.fromRGB(255,255,0)}
        local i = 1
        while true do
            Border.BackgroundColor3 = colors[i]
            i = i + 1
            if i > #colors then i = 1 end
            wait(0.5)
        end
    end)

    -- L·∫•y fruit & hi·ªÉn th·ªã rarity
    local function getAllFruits()
        local fruits = {}
        for _, obj in pairs(Workspace:GetChildren()) do
            if obj:IsA("Tool") and obj.Name:match("Fruit") then
                table.insert(fruits, obj)
            end
        end
        return fruits
    end

    local function getFruitRarity(fruit)
        local name = fruit.Name:lower()
        if name:match("common") then return "Common"
        elseif name:match("uncommon") then return "Uncommon"
        elseif name:match("rare") then return "Rare"
        elseif name:match("mythic") then return "Mythic"
        elseif name:match("legend") then return "Legend"
        else return "Common"
        end
    end

    local function pickupFruit(fruit)
        if fruit and fruit.Parent then
            hrp.CFrame = fruit.Handle.CFrame + Vector3.new(0,3,0)
            wait(0.2)
            local remote = ReplicatedStorage:FindFirstChild("RemoteEvents")
            if remote and remote:FindFirstChild("PickUpFruit") then
                remote.PickUpFruit:FireServer(fruit)
            end
            local rarity = getFruitRarity(fruit)
            stats[rarity] = stats[rarity] + 1
            -- Popup + √¢m thanh
            local Popup = Instance.new("TextLabel")
            Popup.Size = UDim2.new(0,150,0,40)
            Popup.Position = UDim2.new(0.5,-75,0.7,0)
            Popup.BackgroundTransparency = 1
            Popup.Text = "Ph√°t hi·ªán "..fruit.Name.." ["..rarity.."]"
            Popup.TextColor3 = Color3.fromRGB(255,255,0)
            Popup.Font = Enum.Font.GothamBold
            Popup.TextSize = 18
            Popup.Parent = ScreenGui
            TweenService:Create(Popup, TweenInfo.new(1), {Position=UDim2.new(0.5,-75,0.6,0), TextTransparency=1}):Play()
            delay(1,function() Popup:Destroy() end)
            local sound = Instance.new("Sound", hrp)
            sound.SoundId = "rbxassetid://5419095933"
            sound.Volume = 1
            sound:Play()
            delay(2,function() sound:Destroy() end)
            fruit:Destroy()
        end
    end

    -- Update stats
    spawn(function()
        while true do
            local timeRunning = os.time() - startTime
            local minutes = math.floor(timeRunning/60)
            local seconds = timeRunning % 60
            StatsLabel.Text = string.format(
                "‚è± Th·ªùi gian treo: %02d:%02d\n"..
                "üçå Common: %d\n"..
                "üçå Uncommon: %d\n"..
                "üçå Rare: %d\n"..
                "üçå Mythic: %d\n"..
                "üçå Legend: %d\n\n"..
                "üíñ C·∫£m ∆°n b·∫°n ƒë√£ d√πng script!",
                minutes, seconds,
                stats.Common, stats.Uncommon, stats.Rare, stats.Mythic, stats.Legend
            )
            wait(1)
        end
    end)

    -- Toggle AutoPickup
    toggle.MouseButton1Click:Connect(function()
        AutoPickup = not AutoPickup
        toggle.Text = AutoPickup and "T·∫Øt Auto Fruit" or "B·∫≠t Auto Fruit"
    end)

    -- Auto pickup fruit li√™n t·ª•c
    spawn(function()
        while true do
            if AutoPickup then
                local fruits = getAllFruits()
                if #fruits == 0 then
                    InfoLabel.Text = "Kh√¥ng ph√°t hi·ªán fruit, hop server trong "..ServerHopTime.." gi√¢y..."
                    wait(ServerHopTime)
                    HopServer() -- d√πng hop server thay rejoin
                else
                    for _, fruit in pairs(fruits) do
                        InfoLabel.Text = "Ph√°t hi·ªán fruit: "..fruit.Name
                        pickupFruit(fruit)
                    end
                end
            end
            wait(ScanInterval)
        end
    end)
end

-- Kh·ªüi ch·∫°y script t·ª± ƒë·ªông
initVTD()
